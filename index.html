<!DOCTYPE html>
<html>
  <head>
    <title>Animated Burger Menu</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
  </head>
  <body>
    <header>
      <button class="menu-btn">
        <span class="menu-icon"></span>
      </button>
    </header>

    <audio class="shuffleAudio">
      <source src="trimmed-shuffle.wav" type="audio/mpeg">
    </audio>

    <nav class="menu">
      <ul>
        <li><a href="#" class="text" >Story</a></li>
        <li><a href="#" class="text" >Media</a></li>
        <li><a href="#" class="text" >Gallery</a></li>
        <li><a href="#" class="text" >Journal</a></li>
        <li><a href="#" class="text" >About</a></li>
      </ul>
    </nav>

    <script>
      const body = document.body.style.fontFamily = "BasementGrotesque, sans-serif";
      // JavaScript code goes here
      const menuBtn = document.querySelector('.menu-btn');
      const menu = document.querySelector('.menu');

      let menuOpen = false;
      menuBtn.addEventListener('mouseover', () => {
        if (!menuOpen) {
          menuBtn.classList.add('is-active');
          menu.classList.add('is-active');
          menuOpen = true;
        } else {
          menuBtn.classList.remove('is-active');
          menu.classList.remove('is-active');
          menuOpen = false;
        }
      });

      menu.addEventListener('mouseleave', () => {
        menu.classList.remove('is-active')
        menuOpen = false
      })
      
      const texts = document.querySelectorAll('.text');
      let isAudioPlaying = false;

      function shuffleText(text) {
      const theLetters = "abcdefghijklmnopqrstuvwxyz";
      const originalText = text.innerHTML;
      const speed = 7;
      const increment = 8;
      let si = 0;
      let stri = 0;
      let block = "";
      let fixed = "";
      
      // Call self x times, whole function wrapped in setTimeout
      (function rustle (i) {
        setTimeout(() => {
          if (--i){rustle(i);}
          nextFrame(i);
          si = si + 1;
        }, speed);
      })(originalText.length * increment + 1);

      function nextFrame(pos) {
        const audio = document.querySelector('.shuffleAudio');
        if (!isAudioPlaying) {
        isAudioPlaying = true;
        audio.play();
    }


        for (let i = 0; i < originalText.length - stri; i++) {
          const num = Math.floor(theLetters.length * Math.random());
          const letter = theLetters.charAt(num);
          block = block + letter;
        }
        if (si == (increment - 1)){
          stri++;
        }
        if (si == increment) {
          fixed = fixed +  originalText.charAt(stri - 1);
          si = 0;
        }
        text.innerHTML = fixed + block;
        block = "";
        
        // Restore original text at the end of the animation
        if (pos === 1) {
          text.innerHTML = originalText;
          isAudioPlaying = false;
        }
      }
    }



    texts.forEach((text) => {
      text.addEventListener("mouseenter", () => {
        shuffleText(text);
      });
    });

    </script>
  </body>
</html>
